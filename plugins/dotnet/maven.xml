<project default="clean"
  xmlns:j="jelly:core"
  xmlns:u="jelly:util"
  xmlns:x="jelly:xml"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven"
  xmlns:util="jelly:util">

	<property file="build.properties" />

	<preGoal name="java:compile">
		<attainGoal name="nant"/>
	</preGoal>
	
	<goal name="nant" description="Build .NET assemblies">
		<j:set var="assemblyDir" value="${maven.build.dir}/vulcan-plugin-includes"/>

		<ant:mkdir dir="${assemblyDir}"/>

		<ant:echo message="Executing NAnt (logging output to ${maven.build.dir}/nant.log)."/>

		<ant:exec executable="${nant.program.path}" failonerror="true"
				output="${maven.build.dir}/nant.log">
			<ant:arg value="-t:${nant.target.framework}"/>
			<ant:arg value="-D:nunit.bin.dir=${nunit.bin.dir}"/>
		</ant:exec>
		
		<ant:copy toDir="${assemblyDir}" flatten="true">
			<ant:fileset dir="target/assemblies">
				<ant:include name="*.dll"/>
				<ant:exclude name="*Test*.dll"/>
				<ant:exclude name="*test*.dll"/>
			</ant:fileset>
		</ant:copy>
	</goal>
</project>
